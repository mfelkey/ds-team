<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dev-Team Â· Mission Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN SYSTEM â€” Mission Control / Industrial Terminal
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* Surface palette â€” deep charcoal to near-black */
  --bg-void:     #08090c;
  --bg-base:     #0d0f14;
  --bg-raised:   #13161e;
  --bg-surface:  #1a1e2a;
  --bg-elevated: #222738;
  --bg-hover:    #2a3048;

  /* Border & line */
  --border-dim:    #1e2235;
  --border-subtle: #2a3048;
  --border-medium: #3d4463;
  --border-bright: #5568a8;

  /* Text */
  --text-primary:   #e8ecf4;
  --text-secondary: #9ba3bf;
  --text-dim:       #5e6580;
  --text-ghost:     #3d4463;

  /* Accent â€” electric blue command line feel */
  --accent:        #4d7fff;
  --accent-bright: #6b9aff;
  --accent-dim:    #2d5cd6;
  --accent-glow:   rgba(77, 127, 255, 0.15);
  --accent-spark:  rgba(77, 127, 255, 0.4);

  /* Phase colors */
  --phase-orch:    #8b5cf6;
  --phase-plan:    #4d7fff;
  --phase-tspec:   #f59e0b;
  --phase-build:   #10b981;
  --phase-verify:  #06b6d4;
  --phase-mobile:  #0d9488;

  /* Status */
  --status-done:    #10b981;
  --status-active:  #4d7fff;
  --status-pending: #3d4463;
  --status-error:   #ef4444;
  --status-checkpoint: #f59e0b;

  /* Fonts */
  --font-mono: 'JetBrains Mono', 'SF Mono', 'Cascadia Code', monospace;
  --font-sans: 'DM Sans', -apple-system, 'Segoe UI', sans-serif;

  /* Spacing */
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { font-size: 14px; scroll-behavior: smooth; }

body {
  font-family: var(--font-sans);
  background: var(--bg-void);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Scanline overlay for atmosphere */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 9999;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.03) 2px,
    rgba(0,0,0,0.03) 4px
  );
}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--bg-base); }
::-webkit-scrollbar-thumb { background: var(--border-medium); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--accent-dim); }

/* â”€â”€ Layout â”€â”€ */
.app {
  display: grid;
  grid-template-columns: 260px 1fr;
  grid-template-rows: 56px 1fr;
  min-height: 100vh;
}

/* â”€â”€ Top Bar â”€â”€ */
.topbar {
  grid-column: 1 / -1;
  background: var(--bg-base);
  border-bottom: 1px solid var(--border-dim);
  display: flex;
  align-items: center;
  padding: 0 24px;
  gap: 16px;
  z-index: 100;
}

.topbar-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  font-family: var(--font-mono);
  font-weight: 700;
  font-size: 15px;
  color: var(--accent-bright);
  letter-spacing: -0.5px;
}

.topbar-logo .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--status-done);
  box-shadow: 0 0 8px var(--status-done);
  animation: pulse-dot 2s infinite;
}

@keyframes pulse-dot {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

.topbar-divider {
  width: 1px;
  height: 24px;
  background: var(--border-dim);
}

.topbar-project-select {
  background: var(--bg-raised);
  border: 1px solid var(--border-subtle);
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 12px;
  padding: 6px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  min-width: 240px;
}
.topbar-project-select:focus { outline: 1px solid var(--accent); }
.topbar-project-select option { background: var(--bg-raised); }

.topbar-status {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 16px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-dim);
}

.topbar-status .label { color: var(--text-ghost); text-transform: uppercase; letter-spacing: 1px; font-size: 9px; }

/* â”€â”€ Sidebar â”€â”€ */
.sidebar {
  background: var(--bg-base);
  border-right: 1px solid var(--border-dim);
  overflow-y: auto;
  padding: 12px 0;
}

.sidebar-section-label {
  font-family: var(--font-mono);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-ghost);
  padding: 16px 20px 6px;
}

.sidebar-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 20px;
  cursor: pointer;
  transition: all 0.15s;
  border-left: 2px solid transparent;
  font-size: 13px;
  color: var(--text-secondary);
}
.sidebar-item:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}
.sidebar-item.active {
  background: var(--accent-glow);
  border-left-color: var(--accent);
  color: var(--accent-bright);
}
.sidebar-item .icon { font-size: 14px; width: 20px; text-align: center; flex-shrink: 0; }

/* â”€â”€ Main Content â”€â”€ */
.main {
  overflow-y: auto;
  padding: 28px 32px;
  background:
    radial-gradient(ellipse at 20% 0%, rgba(77, 127, 255, 0.04) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 100%, rgba(16, 185, 129, 0.03) 0%, transparent 50%),
    var(--bg-void);
}

.panel { display: none; }
.panel.active { display: block; }

/* â”€â”€ Section Headers â”€â”€ */
.section-header {
  display: flex;
  align-items: baseline;
  gap: 12px;
  margin-bottom: 24px;
}
.section-header h2 {
  font-family: var(--font-mono);
  font-size: 20px;
  font-weight: 600;
  color: var(--text-primary);
  letter-spacing: -0.5px;
}
.section-header .tag {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 500;
  letter-spacing: 1px;
  text-transform: uppercase;
  padding: 3px 8px;
  border-radius: var(--radius-sm);
  color: var(--accent-bright);
  background: var(--accent-glow);
  border: 1px solid rgba(77, 127, 255, 0.2);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PIPELINE TRACKER â€” The visual heart of Mission Control
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pipeline-track {
  margin-bottom: 36px;
}

.pipeline-phase-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 12px;
  margin-top: 24px;
}
.pipeline-phase-header:first-child { margin-top: 0; }

.phase-badge {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 4px 10px;
  border-radius: var(--radius-sm);
  color: white;
}
.phase-badge.orchestrate { background: var(--phase-orch); }
.phase-badge.plan { background: var(--phase-plan); }
.phase-badge.test_spec { background: var(--phase-tspec); }
.phase-badge.build { background: var(--phase-build); }
.phase-badge.test { background: var(--phase-tspec); }
.phase-badge.verify { background: var(--phase-verify); }
.phase-badge.mobile_plan { background: var(--phase-mobile); }
.phase-badge.mobile_test { background: var(--phase-tspec); }
.phase-badge.mobile_build { background: var(--phase-build); }
.phase-badge.mobile_verify { background: var(--phase-verify); }
.phase-badge.mobile { background: var(--phase-mobile); }

.phase-line {
  flex: 1;
  height: 1px;
  background: var(--border-dim);
}

.pipeline-steps {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 10px;
}

.step-card {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  padding: 14px 16px;
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.step-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 2px;
  background: var(--status-pending);
  transition: background 0.3s;
}
.step-card.done::before { background: var(--status-done); }
.step-card.active::before { background: var(--status-active); animation: active-pulse 1.5s infinite; }
.step-card.checkpoint::before { background: var(--status-checkpoint); }

@keyframes active-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.step-card:hover {
  border-color: var(--border-medium);
  background: var(--bg-surface);
  transform: translateY(-1px);
}

.step-card .step-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 6px;
}

.step-card .step-icon {
  font-size: 16px;
}

.step-card .step-status {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--status-pending);
}
.step-card.done .step-status { background: var(--status-done); box-shadow: 0 0 6px var(--status-done); }
.step-card.active .step-status { background: var(--status-active); box-shadow: 0 0 6px var(--status-active); }

.step-card .step-name {
  font-family: var(--font-sans);
  font-weight: 600;
  font-size: 12.5px;
  color: var(--text-primary);
  margin-bottom: 4px;
}

.step-card .step-artifact {
  font-family: var(--font-mono);
  font-size: 10.5px;
  color: var(--text-dim);
}

.step-card .step-checkpoint-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  font-family: var(--font-mono);
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--status-checkpoint);
  background: rgba(245, 158, 11, 0.1);
  border: 1px solid rgba(245, 158, 11, 0.25);
  padding: 2px 6px;
  border-radius: var(--radius-sm);
}

/* Step card expanded â€” command + details */
.step-expand {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s ease;
}
.step-card.expanded .step-expand {
  max-height: 200px;
  padding-top: 10px;
  margin-top: 10px;
  border-top: 1px solid var(--border-dim);
}

.step-command {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg-void);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-sm);
  padding: 8px 10px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-secondary);
  word-break: break-all;
}

.copy-btn {
  flex-shrink: 0;
  background: none;
  border: 1px solid var(--border-subtle);
  color: var(--text-dim);
  cursor: pointer;
  padding: 3px 8px;
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  font-size: 10px;
  transition: all 0.15s;
}
.copy-btn:hover { border-color: var(--accent); color: var(--accent-bright); }
.copy-btn.copied { border-color: var(--status-done); color: var(--status-done); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AGENT CARDS â€” Reference Guide
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.agent-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 14px;
}

.agent-card {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  overflow: hidden;
  transition: all 0.2s;
}
.agent-card:hover {
  border-color: var(--border-medium);
}

.agent-card-header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  cursor: pointer;
  transition: background 0.15s;
}
.agent-card-header:hover { background: var(--bg-surface); }

.agent-card-icon {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-md);
  font-size: 18px;
  flex-shrink: 0;
}
.agent-card-icon.plan { background: rgba(77, 127, 255, 0.12); }
.agent-card-icon.test_spec { background: rgba(245, 158, 11, 0.12); }
.agent-card-icon.build { background: rgba(16, 185, 129, 0.12); }
.agent-card-icon.test { background: rgba(245, 158, 11, 0.12); }
.agent-card-icon.verify { background: rgba(6, 182, 212, 0.12); }
.agent-card-icon.mobile_plan { background: rgba(13, 148, 136, 0.12); }
.agent-card-icon.mobile_test { background: rgba(245, 158, 11, 0.12); }
.agent-card-icon.mobile_build { background: rgba(16, 185, 129, 0.12); }
.agent-card-icon.mobile_verify { background: rgba(6, 182, 212, 0.12); }
.agent-card-icon.mobile { background: rgba(13, 148, 136, 0.12); }

.agent-card-title {
  flex: 1;
}
.agent-card-title h4 {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 2px;
}
.agent-card-title .subtitle {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-dim);
}

.agent-card-tier {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: var(--radius-sm);
  background: var(--bg-surface);
  color: var(--text-secondary);
  border: 1px solid var(--border-dim);
}

.agent-card-chevron {
  color: var(--text-ghost);
  transition: transform 0.2s;
  font-size: 12px;
}
.agent-card.expanded .agent-card-chevron { transform: rotate(90deg); }

.agent-card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease;
}
.agent-card.expanded .agent-card-body {
  max-height: 400px;
}

.agent-card-content {
  padding: 0 16px 16px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.agent-desc {
  font-size: 12.5px;
  color: var(--text-secondary);
  line-height: 1.6;
}

.agent-io {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.agent-io-box {
  background: var(--bg-void);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-sm);
  padding: 10px 12px;
}
.agent-io-box .label {
  font-family: var(--font-mono);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text-ghost);
  margin-bottom: 6px;
}
.agent-io-box .value {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-secondary);
}
.agent-io-box .artifact-tag {
  display: inline-block;
  background: var(--accent-glow);
  color: var(--accent-bright);
  border: 1px solid rgba(77, 127, 255, 0.2);
  padding: 1px 6px;
  border-radius: 3px;
  font-size: 10px;
  margin: 1px 2px;
}

.agent-file-path {
  font-family: var(--font-mono);
  font-size: 10.5px;
  color: var(--text-dim);
  background: var(--bg-void);
  padding: 6px 10px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-dim);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROJECT VIEWER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.project-overview {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap: 14px;
  margin-bottom: 28px;
}

.stat-card {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  padding: 18px 20px;
}
.stat-card .stat-label {
  font-family: var(--font-mono);
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-ghost);
  margin-bottom: 8px;
}
.stat-card .stat-value {
  font-family: var(--font-mono);
  font-size: 24px;
  font-weight: 700;
  color: var(--text-primary);
}
.stat-card .stat-sub {
  font-size: 11px;
  color: var(--text-dim);
  margin-top: 4px;
}

.project-detail-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
}

.detail-panel {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  padding: 20px;
}
.detail-panel h3 {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  margin-bottom: 14px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border-dim);
}

.detail-panel.full-width {
  grid-column: 1 / -1;
}

.artifact-list {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.artifact-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: var(--bg-void);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-dim);
}
.artifact-row .art-type {
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  color: var(--accent-bright);
  min-width: 80px;
}
.artifact-row .art-agent {
  font-size: 11.5px;
  color: var(--text-secondary);
  flex: 1;
}
.artifact-row .art-time {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-ghost);
}

.checkpoint-list { display: flex; flex-direction: column; gap: 6px; }
.checkpoint-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 10px;
  background: var(--bg-void);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-dim);
}
.checkpoint-row .cp-name {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
  flex: 1;
}
.checkpoint-row .cp-status {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: var(--radius-sm);
}
.cp-status.approved { background: rgba(16, 185, 129, 0.15); color: var(--status-done); border: 1px solid rgba(16, 185, 129, 0.3); }
.cp-status.rejected { background: rgba(239, 68, 68, 0.15); color: var(--status-error); border: 1px solid rgba(239, 68, 68, 0.3); }
.cp-status.pending  { background: rgba(245, 158, 11, 0.15); color: var(--status-checkpoint); border: 1px solid rgba(245, 158, 11, 0.3); }

.audit-log {
  max-height: 300px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.audit-entry {
  font-family: var(--font-mono);
  font-size: 10.5px;
  padding: 4px 8px;
  border-radius: var(--radius-sm);
  color: var(--text-dim);
  display: flex;
  gap: 10px;
}
.audit-entry:nth-child(odd) { background: var(--bg-void); }
.audit-entry .ts { color: var(--text-ghost); min-width: 150px; flex-shrink: 0; }
.audit-entry .ev { color: var(--text-secondary); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKPOINT REVIEW INTERFACE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.checkpoint-review {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-lg);
  padding: 24px;
  margin-top: 20px;
}

.checkpoint-review h3 {
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--text-primary);
  margin-bottom: 16px;
}

.checkpoint-actions {
  display: flex;
  gap: 12px;
  align-items: center;
  margin-top: 16px;
}

.btn {
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 600;
  padding: 10px 20px;
  border-radius: var(--radius-md);
  border: none;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.5px;
}
.btn-approve {
  background: var(--status-done);
  color: white;
}
.btn-approve:hover { background: #0d9668; transform: translateY(-1px); }
.btn-reject {
  background: var(--bg-surface);
  color: var(--status-error);
  border: 1px solid rgba(239, 68, 68, 0.3);
}
.btn-reject:hover { background: rgba(239, 68, 68, 0.1); }

.reject-reason {
  width: 100%;
  background: var(--bg-void);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-sm);
  color: var(--text-primary);
  font-family: var(--font-mono);
  font-size: 12px;
  padding: 10px 12px;
  margin-top: 12px;
  resize: vertical;
  min-height: 60px;
  display: none;
}
.reject-reason:focus { outline: 1px solid var(--accent); }
.reject-reason.visible { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMMAND CHEAT SHEET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cheat-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 10px;
}

.cheat-card {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  padding: 14px 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.cheat-card .cheat-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 4px;
}
.cheat-card .cheat-cmd {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--accent-bright);
  word-break: break-all;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPTY STATES & LOADING
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--text-dim);
}
.empty-state .icon { font-size: 36px; margin-bottom: 12px; }
.empty-state h3 {
  font-family: var(--font-mono);
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 8px;
}
.empty-state p {
  font-size: 12px;
  color: var(--text-dim);
  max-width: 400px;
  margin: 0 auto;
  line-height: 1.6;
}

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: var(--bg-elevated);
  border: 1px solid var(--border-medium);
  border-radius: var(--radius-md);
  padding: 12px 18px;
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--text-primary);
  z-index: 10000;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.2s;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateY(0); }

/* â”€â”€ No-project info banner â”€â”€ */
.info-banner {
  background: var(--accent-glow);
  border: 1px solid rgba(77, 127, 255, 0.2);
  border-radius: var(--radius-md);
  padding: 16px 20px;
  margin-bottom: 20px;
  display: flex;
  align-items: flex-start;
  gap: 12px;
}
.info-banner .info-icon { font-size: 18px; flex-shrink: 0; margin-top: 1px; }
.info-banner .info-text { font-size: 12.5px; color: var(--text-secondary); line-height: 1.6; }
.info-banner .info-text strong { color: var(--accent-bright); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NEW PROJECT FORM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.new-project-layout {
  display: grid;
  grid-template-columns: 1fr 380px;
  gap: 24px;
  align-items: start;
}

.np-field { margin-bottom: 16px; }

.np-label {
  display: block;
  font-family: var(--font-mono);
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.5px;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.np-required { color: var(--status-error); }
.np-optional { font-weight: 400; color: var(--text-ghost); font-size: 10px; }

.np-input, .np-textarea, .np-select {
  width: 100%;
  background: var(--bg-raised);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  color: var(--text-primary);
  font-family: var(--font-sans);
  font-size: 13px;
  padding: 10px 14px;
  transition: border-color 0.15s, box-shadow 0.15s;
}
.np-input:focus, .np-textarea:focus, .np-select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.np-input::placeholder, .np-textarea::placeholder {
  color: var(--text-ghost);
}

.np-textarea {
  min-height: 180px;
  resize: vertical;
  line-height: 1.7;
  font-size: 13px;
}

.np-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%235e6580'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding-right: 32px;
}
.np-select option { background: var(--bg-raised); }

.np-char-count {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--text-ghost);
  margin-top: 4px;
  text-align: right;
}

.np-options-row {
  display: flex;
  gap: 14px;
}

.np-checkbox-label {
  display: flex !important;
  align-items: center;
  gap: 8px;
  cursor: pointer;
}
.np-checkbox-label input[type="checkbox"] {
  width: 16px;
  height: 16px;
  accent-color: var(--accent);
  cursor: pointer;
}

.np-actions {
  display: flex;
  gap: 10px;
  margin-top: 4px;
}

.btn-create {
  background: var(--accent);
  color: white;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px 24px;
  font-size: 13px;
}
.btn-create:hover { background: var(--accent-bright); transform: translateY(-1px); box-shadow: 0 4px 16px var(--accent-glow); }
.btn-create:active { transform: translateY(0); }
.btn-create .btn-icon { font-size: 14px; }

.btn-secondary {
  background: var(--bg-surface);
  color: var(--text-secondary);
  border: 1px solid var(--border-subtle);
}
.btn-secondary:hover { background: var(--bg-hover); color: var(--text-primary); }

.btn.loading {
  opacity: 0.7;
  pointer-events: none;
  position: relative;
}
.btn.loading::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 12px;
  width: 14px;
  height: 14px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Result card after creation */
.np-result {
  margin-top: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border-subtle);
  border-radius: var(--radius-md);
  padding: 16px 20px;
  animation: fadeSlideIn 0.3s ease;
}
@keyframes fadeSlideIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}
.np-result.success { border-color: rgba(16, 185, 129, 0.4); background: rgba(16, 185, 129, 0.06); }
.np-result.error { border-color: rgba(239, 68, 68, 0.4); background: rgba(239, 68, 68, 0.06); }

.np-result-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
}
.np-result-header .icon { font-size: 18px; }
.np-result-header .title {
  font-family: var(--font-mono);
  font-size: 14px;
  font-weight: 600;
  color: var(--text-primary);
}
.np-result-id {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--accent-bright);
  background: var(--accent-glow);
  display: inline-block;
  padding: 2px 10px;
  border-radius: var(--radius-sm);
  margin-bottom: 10px;
}
.np-result-next {
  display: flex;
  flex-direction: column;
  gap: 6px;
  margin-top: 10px;
}
.np-result-cmd {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--bg-void);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-sm);
  padding: 8px 12px;
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--text-secondary);
}
.np-result-cmd .num {
  color: var(--text-ghost);
  font-weight: 700;
  min-width: 18px;
}

/* Guide cards â€” right column */
.np-guide-area {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.np-guide-card {
  background: var(--bg-raised);
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-md);
  overflow: hidden;
}
.np-guide-card h4 {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-primary);
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-dim);
  background: var(--bg-surface);
}
.np-guide-body {
  padding: 14px 16px;
}
.np-guide-body p {
  font-size: 12px;
  color: var(--text-secondary);
  line-height: 1.6;
  margin-bottom: 10px;
}

.np-guide-checklist {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.np-check {
  font-family: var(--font-mono);
  font-size: 10.5px;
  color: var(--text-dim);
  padding: 3px 0;
}

/* Example cards â€” clickable */
.np-example {
  padding: 10px 12px;
  border: 1px solid var(--border-dim);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.15s;
}
.np-example:last-child { margin-bottom: 0; }
.np-example:hover {
  border-color: var(--accent);
  background: var(--accent-glow);
}
.np-example-label {
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  letter-spacing: 0.5px;
  text-transform: uppercase;
  color: var(--accent-bright);
  margin-bottom: 4px;
}
.np-example-text {
  font-size: 11px;
  color: var(--text-dim);
  line-height: 1.5;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.np-example:hover .np-example-text { color: var(--text-secondary); }

/* Next steps */
.np-next-steps { padding: 10px 16px; }
.np-step-row {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 6px 0;
  font-size: 12px;
  color: var(--text-secondary);
}
.np-step-row code {
  font-size: 10px;
  background: var(--bg-void);
  padding: 1px 6px;
  border-radius: 3px;
  color: var(--text-dim);
}
.np-step-num {
  width: 22px;
  height: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: var(--bg-void);
  border: 1px solid var(--border-dim);
  font-family: var(--font-mono);
  font-size: 10px;
  font-weight: 700;
  color: var(--text-ghost);
  flex-shrink: 0;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 900px) {
  .app {
    grid-template-columns: 1fr;
    grid-template-rows: 56px auto 1fr;
  }
  .sidebar {
    display: flex;
    overflow-x: auto;
    border-right: none;
    border-bottom: 1px solid var(--border-dim);
    padding: 0 8px;
  }
  .sidebar-section-label { display: none; }
  .sidebar-item {
    border-left: none;
    border-bottom: 2px solid transparent;
    padding: 10px 14px;
    white-space: nowrap;
    font-size: 12px;
  }
  .sidebar-item.active { border-bottom-color: var(--accent); border-left: none; }
  .main { padding: 20px 16px; }
  .project-overview { grid-template-columns: 1fr; }
  .project-detail-grid { grid-template-columns: 1fr; }
  .agent-grid { grid-template-columns: 1fr; }
  .new-project-layout { grid-template-columns: 1fr; }
  .np-options-row { flex-direction: column; }
}
</style>
</head>
<body>

<div class="app">
  <!-- â•â•â• TOP BAR â•â•â• -->
  <div class="topbar">
    <div class="topbar-logo">
      <div class="dot"></div>
      dev-team
    </div>
    <div class="topbar-divider"></div>
    <select class="topbar-project-select" id="projectSelect">
      <option value="">â€” Select a project â€”</option>
    </select>
    <div class="topbar-status">
      <div><span class="label">Status</span><br><span id="topStatus">No project</span></div>
      <div><span class="label">Classification</span><br><span id="topClass">â€”</span></div>
      <div><span class="label">Artifacts</span><br><span id="topArtifacts">0</span></div>
    </div>
  </div>

  <!-- â•â•â• SIDEBAR â•â•â• -->
  <div class="sidebar">
    <div class="sidebar-section-label">Actions</div>
    <div class="sidebar-item" data-panel="newproject">
      <span class="icon">ï¼‹</span> New Project
    </div>
    <div class="sidebar-section-label">Views</div>
    <div class="sidebar-item active" data-panel="pipeline">
      <span class="icon">â–¸</span> Pipeline Tracker
    </div>
    <div class="sidebar-item" data-panel="agents">
      <span class="icon">â—†</span> Agent Reference
    </div>
    <div class="sidebar-item" data-panel="project">
      <span class="icon">â—‡</span> Project Status
    </div>
    <div class="sidebar-item" data-panel="checkpoints">
      <span class="icon">â¸</span> Checkpoints
    </div>
    <div class="sidebar-item" data-panel="commands">
      <span class="icon">â€º_</span> Commands
    </div>
  </div>

  <!-- â•â•â• MAIN CONTENT â•â•â• -->
  <div class="main">

    <!-- â”€â”€ New Project Panel â”€â”€ -->
    <div class="panel" id="panel-newproject">
      <div class="section-header">
        <h2>New Project</h2>
        <span class="tag">Describe â†’ Build</span>
      </div>

      <div class="new-project-layout">
        <!-- Left: The form -->
        <div class="np-form-area">
          <div class="np-field">
            <label class="np-label">Project Title <span class="np-optional">(optional â€” auto-generated if blank)</span></label>
            <input type="text" class="np-input" id="npTitle" placeholder="e.g. VA Ambulance Trip Dashboard">
          </div>

          <div class="np-field">
            <label class="np-label">Describe what you want <span class="np-required">*</span></label>
            <textarea class="np-textarea" id="npDescription" placeholder="Tell the agents what to build. Be specific about features, data sources, deployment targets, and user types. The more detail you give, the better the output."></textarea>
            <div class="np-char-count"><span id="npCharCount">0</span> characters â€” aim for 200+</div>
          </div>

          <div class="np-options-row">
            <div class="np-field" style="flex:1;">
              <label class="np-label">Complexity hint</label>
              <select class="np-select" id="npComplexity">
                <option value="LOW">Low â€” simple CRUD, few screens</option>
                <option value="MEDIUM" selected>Medium â€” multiple modules, auth, API</option>
                <option value="HIGH">High â€” multi-platform, data pipeline, ML</option>
              </select>
            </div>
            <div class="np-field" style="flex:1;">
              <label class="np-label">Involves data analysis?</label>
              <select class="np-select" id="npDataRequired">
                <option value="false">No â€” software only (DEV crew)</option>
                <option value="true">Yes â€” analyze data first (JOINT crew)</option>
              </select>
            </div>
          </div>

          <div class="np-field">
            <label class="np-label np-checkbox-label">
              <input type="checkbox" id="npRunClassify">
              <span>Auto-run Orchestrator after creation <span class="np-optional">(Phase 2 â€” requires classify.py)</span></span>
            </label>
          </div>

          <div class="np-actions">
            <button class="btn btn-create" id="npSubmit" onclick="createProject()">
              <span class="btn-icon">â–¸</span> Create Project
            </button>
            <button class="btn btn-secondary" onclick="clearProjectForm()">Clear</button>
          </div>

          <!-- Result area -->
          <div class="np-result" id="npResult" style="display:none;"></div>
        </div>

        <!-- Right: Tips & examples -->
        <div class="np-guide-area">
          <div class="np-guide-card">
            <h4>ğŸ’¡ What makes a good description?</h4>
            <div class="np-guide-body">
              <p>The Orchestrator and Product Manager work directly from your text. The more specific you are, the better every downstream agent performs.</p>
              <div class="np-guide-checklist">
                <div class="np-check">âœ“ What the app does (features, screens)</div>
                <div class="np-check">âœ“ Who uses it (user types, roles)</div>
                <div class="np-check">âœ“ What data it works with</div>
                <div class="np-check">âœ“ Where it's deployed (web, mobile, both)</div>
                <div class="np-check">âœ“ Any constraints (accessibility, offline, auth)</div>
              </div>
            </div>
          </div>

          <div class="np-guide-card">
            <h4>ğŸ“ Example descriptions</h4>
            <div class="np-guide-body">
              <div class="np-example" onclick="useExample(this)">
                <div class="np-example-label">Simple web app</div>
                <div class="np-example-text">Build an interactive dashboard for tracking monthly ambulance trip data with filters for trip type, date range, provider, and geographic region. The dashboard should display summary statistics, trend charts, and a data table with export functionality. Deploy as a containerized web app with a React frontend and Node.js API backend. Users are VA administrators who need WCAG 2.1 AA accessibility.</div>
              </div>
              <div class="np-example" onclick="useExample(this)">
                <div class="np-example-label">Data + app (JOINT)</div>
                <div class="np-example-text">Analyze our ambulance trip dataset to identify patterns in response times, costs, and geographic distribution. Build statistical models to predict trip costs based on distance, type, and time of day. Then build a web dashboard and cross-platform mobile app that surfaces these insights with interactive filters. The mobile app should work offline with cached data and support both iOS and Android.</div>
              </div>
              <div class="np-example" onclick="useExample(this)">
                <div class="np-example-label">API + automation</div>
                <div class="np-example-text">Build a REST API and automated reporting system for VA ambulance trip data. The API should support CRUD operations, role-based access control, rate limiting, and webhook notifications when new data is uploaded. Generate weekly PDF reports with summary statistics and anomaly detection. Deploy with CI/CD pipelines and infrastructure-as-code. Include comprehensive API documentation and a Postman collection.</div>
              </div>
            </div>
          </div>

          <div class="np-guide-card">
            <h4>âš¡ What happens next</h4>
            <div class="np-guide-body np-next-steps">
              <div class="np-step-row"><span class="np-step-num">1</span> Project JSON file created in <code>logs/</code></div>
              <div class="np-step-row"><span class="np-step-num">2</span> Run <strong>Classify</strong> â€” Orchestrator structures your description</div>
              <div class="np-step-row"><span class="np-step-num">3</span> Run <strong>Route</strong> â€” assigns to the right crew (DEV / DS / JOINT)</div>
              <div class="np-step-row"><span class="np-step-num">4</span> Run agents from the <strong>Pipeline Tracker</strong></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ Pipeline Tracker Panel â”€â”€ -->
    <div class="panel active" id="panel-pipeline">
      <div class="section-header">
        <h2>Pipeline Tracker</h2>
        <span class="tag">Live Status</span>
      </div>
      <div id="pipelineContent"></div>
    </div>

    <!-- â”€â”€ Agent Reference Panel â”€â”€ -->
    <div class="panel" id="panel-agents">
      <div class="section-header">
        <h2>Agent Reference</h2>
        <span class="tag">20+ Agents</span>
      </div>
      <div id="agentContent"></div>
    </div>

    <!-- â”€â”€ Project Status Panel â”€â”€ -->
    <div class="panel" id="panel-project">
      <div class="section-header">
        <h2>Project Status</h2>
        <span class="tag">Context Viewer</span>
      </div>
      <div id="projectContent"></div>
    </div>

    <!-- â”€â”€ Checkpoints Panel â”€â”€ -->
    <div class="panel" id="panel-checkpoints">
      <div class="section-header">
        <h2>Checkpoint Review</h2>
        <span class="tag">Approve / Reject</span>
      </div>
      <div id="checkpointContent"></div>
    </div>

    <!-- â”€â”€ Commands Panel â”€â”€ -->
    <div class="panel" id="panel-commands">
      <div class="section-header">
        <h2>Command Cheat Sheet</h2>
        <span class="tag">Click to Copy</span>
      </div>
      <div id="commandContent"></div>
    </div>

  </div>
</div>

<!-- Toast notification -->
<div class="toast" id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP STATE & DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const state = {
  pipeline: null,
  agents: null,
  projects: [],
  currentProject: null,
  completedSteps: new Set(),
  activePanel: 'pipeline',
};

// â”€â”€ API calls â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function fetchJSON(url) {
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    return await res.json();
  } catch (e) {
    console.warn(`Fetch failed: ${url}`, e);
    return null;
  }
}

async function loadPipeline() {
  state.pipeline = await fetchJSON('/api/pipeline');
}

async function loadAgents() {
  state.agents = await fetchJSON('/api/agents');
}

async function loadProjects() {
  state.projects = await fetchJSON('/api/projects') || [];
  renderProjectSelect();
}

async function loadProject(id) {
  if (!id) { state.currentProject = null; updateAll(); return; }
  state.currentProject = await fetchJSON(`/api/projects/${id}`);
  const status = await fetchJSON(`/api/projects/${id}/status`);
  state.completedSteps = new Set(status?.completed_steps || []);
  updateAll();
}

// â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// â”€â”€ Clipboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function copyCmd(text, btn) {
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = 'âœ“';
    btn.classList.add('copied');
    showToast(`Copied: ${text.slice(0, 50)}â€¦`);
    setTimeout(() => { btn.textContent = 'copy'; btn.classList.remove('copied'); }, 1500);
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderProjectSelect() {
  const sel = document.getElementById('projectSelect');
  sel.innerHTML = '<option value="">â€” Select a project â€”</option>';
  state.projects.forEach(p => {
    const opt = document.createElement('option');
    opt.value = p.id;
    opt.textContent = `${p.id} â€” ${p.title || 'Untitled'} [${p.status}]`;
    sel.appendChild(opt);
  });
}

function updateTopBar() {
  const p = state.currentProject;
  document.getElementById('topStatus').textContent = p ? p.status : 'No project';
  document.getElementById('topClass').textContent = p ? p.classification : 'â€”';
  document.getElementById('topArtifacts').textContent = p ? (p.artifacts?.length || 0) : '0';
}

// â”€â”€ Pipeline Tracker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderPipeline() {
  const container = document.getElementById('pipelineContent');
  if (!state.pipeline) { container.innerHTML = '<div class="empty-state"><div class="icon">â³</div><h3>Loading pipeline dataâ€¦</h3></div>'; return; }

  let html = '';

  if (!state.currentProject) {
    html += `<div class="info-banner">
      <span class="info-icon">â„¹ï¸</span>
      <div class="info-text">Select a project from the top bar to see live status. The pipeline below shows the full agent sequence â€” click any card to see its command.</div>
    </div>`;
  }

  const pipelineOrder = ['web', 'mobile'];
  const phaseLabels = {
    orchestrate: 'Orchestration',
    plan: 'Planning',
    test_spec: 'Test Spec â€” TDD',
    build: 'Build (against tests)',
    verify: 'Verify',
    mobile_plan: 'Mobile UX',
    mobile_test: 'Mobile Test Spec â€” TDD',
    mobile_build: 'Mobile Build (against tests)',
    mobile_verify: 'Mobile Verify',
    mobile: 'Mobile',
  };

  pipelineOrder.forEach(pipelineName => {
    const steps = state.pipeline[pipelineName];
    if (!steps) return;

    // Group by phase
    const phases = {};
    steps.forEach(s => {
      if (!phases[s.phase]) phases[s.phase] = [];
      phases[s.phase].push(s);
    });

    Object.entries(phases).forEach(([phase, phaseSteps]) => {
      html += `<div class="pipeline-phase-header">
        <span class="phase-badge ${phase}">${phaseLabels[phase] || phase}</span>
        <span class="phase-line"></span>
      </div>`;

      html += '<div class="pipeline-steps">';
      phaseSteps.forEach(step => {
        const done = state.completedSteps.has(step.id);
        const classes = ['step-card'];
        if (done) classes.push('done');
        if (step.checkpoint) classes.push('checkpoint');

        html += `<div class="${classes.join(' ')}" onclick="toggleStep(this)" data-cmd="${step.command}">
          ${step.checkpoint ? '<span class="step-checkpoint-badge">â¸ Gate</span>' : ''}
          <div class="step-top">
            <span class="step-icon">${step.icon}</span>
            <span class="step-status"></span>
          </div>
          <div class="step-name">${step.name}</div>
          <div class="step-artifact">â†’ ${step.produces}</div>
          <div class="step-expand">
            <div class="step-command">
              <span style="flex:1">${step.command}</span>
              <button class="copy-btn" onclick="event.stopPropagation(); copyCmd('${step.command}', this)">copy</button>
            </div>
          </div>
        </div>`;
      });
      html += '</div>';
    });
  });

  container.innerHTML = html;
}

function toggleStep(el) {
  el.classList.toggle('expanded');
}

// â”€â”€ Agent Reference â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderAgents() {
  const container = document.getElementById('agentContent');
  if (!state.agents) { container.innerHTML = '<div class="empty-state"><div class="icon">â³</div><h3>Loading agent dataâ€¦</h3></div>'; return; }

  // Group agents by phase
  const phaseMap = {};
  if (state.pipeline) {
    Object.values(state.pipeline).flat().forEach(step => {
      if (state.agents[step.id]) {
        if (!phaseMap[step.phase]) phaseMap[step.phase] = [];
        phaseMap[step.phase].push({ ...state.agents[step.id], _id: step.id, _icon: step.icon, _phase: step.phase });
      }
    });
  }

  const phaseLabels = { orchestrate: 'Orchestration', plan: 'Planning', test_spec: 'Test Spec â€” TDD', build: 'Build (against tests)', verify: 'Verify', mobile_plan: 'Mobile UX', mobile_test: 'Mobile Test Spec â€” TDD', mobile_build: 'Mobile Build (against tests)', mobile_verify: 'Mobile Verify', mobile: 'Mobile' };
  let html = '';

  Object.entries(phaseLabels).forEach(([phase, label]) => {
    const agents = phaseMap[phase];
    if (!agents || agents.length === 0) return;

    html += `<div class="pipeline-phase-header">
      <span class="phase-badge ${phase}">${label}</span>
      <span class="phase-line"></span>
    </div>`;
    html += '<div class="agent-grid">';

    agents.forEach(agent => {
      html += `<div class="agent-card" onclick="this.classList.toggle('expanded')">
        <div class="agent-card-header">
          <div class="agent-card-icon ${agent._phase}">${agent._icon}</div>
          <div class="agent-card-title">
            <h4>${agent._id.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()).replace(/Rn /g, 'RN ').replace(/Ios /g, 'iOS ').replace(/Ux /g, 'UX ').replace(/Qa /g, 'QA ').replace(/Dba/g, 'DBA')}</h4>
            <span class="subtitle">â†’ ${agent.produces}</span>
          </div>
          <span class="agent-card-tier">${agent.tier}</span>
          <span class="agent-card-chevron">â–¸</span>
        </div>
        <div class="agent-card-body">
          <div class="agent-card-content">
            <div class="agent-desc">${agent.description}</div>
            <div class="agent-io">
              <div class="agent-io-box">
                <div class="label">Consumes</div>
                <div class="value">${agent.consumes.map(c => `<span class="artifact-tag">${c}</span>`).join(' ')}</div>
              </div>
              <div class="agent-io-box">
                <div class="label">Produces</div>
                <div class="value"><span class="artifact-tag">${agent.produces}</span></div>
              </div>
            </div>
            <div class="agent-io">
              <div class="agent-io-box">
                <div class="label">Model</div>
                <div class="value">${agent.model}</div>
              </div>
              <div class="agent-io-box">
                <div class="label">File</div>
                <div class="value" style="font-size:10px;">${agent.file}</div>
              </div>
            </div>
          </div>
        </div>
      </div>`;
    });

    html += '</div>';
  });

  container.innerHTML = html;
}

// â”€â”€ Project Status â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderProject() {
  const container = document.getElementById('projectContent');
  const p = state.currentProject;

  if (!p) {
    container.innerHTML = `<div class="empty-state">
      <div class="icon">ğŸ“‚</div>
      <h3>No Project Selected</h3>
      <p>Select a project from the dropdown in the top bar, or start a new one with:<br><code style="color:var(--accent-bright);font-size:11px;">python agents/orchestrator/classify.py</code></p>
    </div>`;
    return;
  }

  const spec = p.structured_spec || {};
  const artifacts = p.artifacts || [];
  const checkpoints = p.checkpoints || [];
  const auditLog = p.audit_log || [];

  let html = `
    <div class="project-overview">
      <div class="stat-card">
        <div class="stat-label">Project ID</div>
        <div class="stat-value" style="font-size:16px;">${p.project_id}</div>
        <div class="stat-sub">${spec.title || 'Untitled'}</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Status</div>
        <div class="stat-value" style="font-size:16px;">${p.status}</div>
        <div class="stat-sub">${p.classification} classification</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Progress</div>
        <div class="stat-value">${artifacts.length}<span style="font-size:14px;color:var(--text-dim);"> artifacts</span></div>
        <div class="stat-sub">${checkpoints.length} checkpoints reached</div>
      </div>
    </div>

    <div class="project-detail-grid">
      <div class="detail-panel">
        <h3>Structured Spec</h3>
        ${spec.description ? `<p style="font-size:12px;color:var(--text-secondary);margin-bottom:10px;">${spec.description}</p>` : ''}
        ${spec.deliverables ? `<div style="margin-bottom:8px;"><strong style="font-size:10px;color:var(--text-ghost);letter-spacing:1px;">DELIVERABLES</strong><br>${spec.deliverables.map(d => `<span style="display:inline-block;font-size:11px;color:var(--text-secondary);background:var(--bg-void);border:1px solid var(--border-dim);padding:2px 8px;border-radius:3px;margin:2px;">${d}</span>`).join('')}</div>` : ''}
        ${spec.success_criteria ? `<div><strong style="font-size:10px;color:var(--text-ghost);letter-spacing:1px;">SUCCESS CRITERIA</strong><br>${spec.success_criteria.map(c => `<div style="font-size:11px;color:var(--text-dim);padding:2px 0;">âœ“ ${c}</div>`).join('')}</div>` : ''}
      </div>

      <div class="detail-panel">
        <h3>Artifacts (${artifacts.length})</h3>
        <div class="artifact-list">
          ${artifacts.length === 0 ? '<div style="color:var(--text-ghost);font-size:12px;">No artifacts yet</div>' :
            artifacts.map(a => `<div class="artifact-row">
              <span class="art-type">${a.type || '?'}</span>
              <span class="art-agent">${a.agent || 'â€”'}</span>
              <span class="art-time">${a.created_at ? new Date(a.created_at).toLocaleString() : ''}</span>
            </div>`).join('')}
        </div>
      </div>

      <div class="detail-panel full-width">
        <h3>Audit Log (${auditLog.length} events)</h3>
        <div class="audit-log">
          ${auditLog.length === 0 ? '<div style="color:var(--text-ghost);font-size:12px;">No events recorded</div>' :
            auditLog.slice(-50).reverse().map(e => `<div class="audit-entry">
              <span class="ts">${e.timestamp ? new Date(e.timestamp).toLocaleString() : ''}</span>
              <span class="ev">${e.event || ''} ${e.detail ? 'â€” ' + e.detail : ''}</span>
            </div>`).join('')}
        </div>
      </div>
    </div>`;

  container.innerHTML = html;
}

// â”€â”€ Checkpoints â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderCheckpoints() {
  const container = document.getElementById('checkpointContent');
  const p = state.currentProject;

  // Define all checkpoint gates
  const gates = [
    { id: 'CP-1', name: 'Requirements Review', agent: 'Product Manager â†’ PRD', check: 'Are the user stories right? Is the scope right?' },
    { id: 'CP-2', name: 'Architecture Review', agent: 'Technical Architect â†’ TAD', check: 'Does the technology make sense? Is the system design achievable?' },
    { id: 'CP-3', name: 'Security Gate', agent: 'Security Reviewer â†’ SRR', check: 'Is the rating acceptable (ğŸŸ¢/ğŸŸ¡/ğŸ”´)? Are security requirements reasonable?' },
    { id: 'CP-4', name: 'Design Review', agent: 'UX Designer â†’ UXD + Content Guide', check: 'Does the UI make sense? Is the language clear? All screens covered?' },
    { id: 'CP-5', name: 'Test Spec Review (TDD)', agent: 'Test Automation â†’ TAR', check: 'Do the tests cover all acceptance criteria? Are test contracts well-defined before build begins?' },
    { id: 'CP-6', name: 'Build Complete', agent: 'DevOps Engineer â†’ DIR', check: 'Spot-check the code. Does it reference the test contracts? Search for TODO or placeholder.' },
    { id: 'CP-7', name: 'Penetration Test', agent: 'Penetration Tester â†’ PTR', check: 'Is the PTR rated ğŸŸ¢ PASS or ğŸŸ¡ CONDITIONAL? Are all CRITICAL/HIGH findings addressed? Any ğŸ”´ FAIL blocks release.' },
    { id: 'CP-8', name: 'Scalability Review', agent: 'Scalability Architect â†’ SAR', check: 'Is the SAR rated ğŸŸ¢ SCALE-READY? Multi-tenant, high-throughput, large dataset, and global distribution all addressed?' },
    { id: 'CP-9', name: 'Performance Audit', agent: 'Performance Auditor â†’ PAR', check: 'Does the PAR show ğŸŸ¢ MEETS BUDGETS? All PBD targets met? No CRITICAL/HIGH violations?' },
    { id: 'CP-10', name: 'Accessibility Audit', agent: 'Accessibility Specialist â†’ AAR', check: 'Is the AAR rated ğŸŸ¢ ACCESSIBLE? WCAG 2.2 AA compliant across all platforms? No CRITICAL barriers?' },
    { id: 'CP-11', name: 'Verification Gate (TDD)', agent: 'Test Verification â†’ Report', check: 'Do all pre-written tests pass? Coverage targets met? No regressions?' },
  ];

  let html = '';

  if (!p) {
    html += `<div class="info-banner">
      <span class="info-icon">â„¹ï¸</span>
      <div class="info-text">Select a project to see checkpoint status. Below is the reference for what each checkpoint validates.</div>
    </div>`;
  }

  const checkpoints = p?.checkpoints || [];

  html += '<div class="checkpoint-list" style="margin-bottom:24px;">';
  gates.forEach(gate => {
    const match = checkpoints.find(c => c.name?.includes(gate.id) || c.name?.includes(gate.name));
    const status = match ? (match.action || match.status || 'APPROVED').toUpperCase() : 'PENDING';
    const statusClass = status === 'APPROVED' ? 'approved' : status === 'REJECTED' ? 'rejected' : 'pending';

    html += `<div class="checkpoint-row">
      <span style="font-family:var(--font-mono);font-size:11px;font-weight:700;color:var(--status-checkpoint);min-width:40px;">${gate.id}</span>
      <span class="cp-name">${gate.name}</span>
      <span style="font-size:11px;color:var(--text-dim);flex:1;">${gate.check}</span>
      <span class="cp-status ${statusClass}">${status}</span>
    </div>`;
  });
  html += '</div>';

  // Active checkpoint review (Phase 2 ready)
  html += `<div class="checkpoint-review">
    <h3>â¸ Review Active Checkpoint</h3>
    <p style="font-size:12px;color:var(--text-dim);margin-bottom:12px;">When a checkpoint fires, review the artifact file, then approve or reject here.</p>
    <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
      <span style="font-family:var(--font-mono);font-size:10px;color:var(--text-ghost);">Quick check:</span>
      <button class="copy-btn" onclick="copyCmd('grep -ri \"todo\\\\|placeholder\\\\|implement here\\\\|TBD\" dev/requirements/ dev/build/ dev/quality/', this)" style="font-size:11px;padding:5px 10px;">Copy: grep for TODOs</button>
      <button class="copy-btn" onclick="copyCmd('cat FLAGS.md', this)" style="font-size:11px;padding:5px 10px;">Copy: check FLAGS.md</button>
    </div>
    <div class="checkpoint-actions">
      <button class="btn btn-approve" onclick="handleCheckpoint('APPROVE')">âœ“ Approve</button>
      <button class="btn btn-reject" onclick="document.getElementById('rejectReason').classList.toggle('visible')">âœ— Reject</button>
    </div>
    <textarea class="reject-reason" id="rejectReason" placeholder="Reason for rejection (helps guide the re-run)â€¦"></textarea>
  </div>`;

  container.innerHTML = html;
}

async function handleCheckpoint(action) {
  const reason = document.getElementById('rejectReason')?.value || '';
  const projectId = state.currentProject?.project_id;
  if (!projectId) { showToast('No project selected'); return; }

  const res = await fetch(`/api/checkpoint/${projectId}`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ action, reason })
  });
  const data = await res.json();
  showToast(`${action}: ${data.message}`);
}

// â”€â”€ Commands â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderCommands() {
  const container = document.getElementById('commandContent');

  const sections = [
    {
      title: 'Startup',
      commands: [
        { label: 'Activate virtualenv', cmd: 'cd ~/dev-team && source .venv/bin/activate' },
        { label: 'Check Ollama is running', cmd: 'curl http://localhost:11434/api/tags' },
        { label: 'Start Ollama', cmd: 'sudo systemctl start ollama' },
        { label: 'Check GPU/RAM', cmd: 'ollama ps' },
      ]
    },
    {
      title: 'Git',
      commands: [
        { label: 'Commit (replace XXXXX)', cmd: 'git add -A && git commit -m "PROJ-XXXXX: Agent â†’ Artifact complete"' },
        { label: 'Tag release', cmd: 'git tag PROJ-XXXXX-v1.0' },
      ]
    },
    {
      title: 'Troubleshooting',
      commands: [
        { label: 'Grep for placeholders', cmd: 'grep -ri "todo\\|placeholder\\|implement here\\|TBD" dev/' },
        { label: 'Check FLAGS.md', cmd: 'cat FLAGS.md' },
        { label: 'Archive & start over', cmd: 'mkdir -p logs/archive && mv logs/PROJ-*.json logs/archive/ && python agents/orchestrator/classify.py' },
        { label: 'Restart Ollama', cmd: 'sudo systemctl restart ollama && curl http://localhost:11434/api/tags' },
      ]
    }
  ];

  let html = '';

  sections.forEach(section => {
    html += `<div class="pipeline-phase-header">
      <span class="phase-badge plan">${section.title}</span>
      <span class="phase-line"></span>
    </div>`;
    html += '<div class="cheat-grid">';
    section.commands.forEach(c => {
      html += `<div class="cheat-card">
        <div>
          <div class="cheat-label">${c.label}</div>
          <div class="cheat-cmd">${c.cmd}</div>
        </div>
        <button class="copy-btn" onclick="copyCmd(\`${c.cmd.replace(/`/g, '\\`')}\`, this)">copy</button>
      </div>`;
    });
    html += '</div>';
  });

  // Full pipeline commands
  if (state.pipeline) {
    ['web', 'mobile'].forEach(pipelineName => {
      const steps = state.pipeline[pipelineName];
      if (!steps) return;
      const label = pipelineName.charAt(0).toUpperCase() + pipelineName.slice(1) + ' Pipeline';
      const phaseClass = pipelineName === 'web' ? 'build' : 'mobile';

      html += `<div class="pipeline-phase-header" style="margin-top:20px;">
        <span class="phase-badge ${phaseClass}">${label}</span>
        <span class="phase-line"></span>
      </div>`;
      html += '<div class="cheat-grid">';
      steps.forEach((s, i) => {
        html += `<div class="cheat-card">
          <div>
            <div class="cheat-label">${i + 1}. ${s.name} ${s.checkpoint ? 'â¸' : ''}</div>
            <div class="cheat-cmd">${s.command}</div>
          </div>
          <button class="copy-btn" onclick="copyCmd('${s.command}', this)">copy</button>
        </div>`;
      });
      html += '</div>';
    });
  }

  container.innerHTML = html;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEW PROJECT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Character counter
document.getElementById('npDescription')?.addEventListener('input', (e) => {
  document.getElementById('npCharCount').textContent = e.target.value.length;
});

function useExample(el) {
  const text = el.querySelector('.np-example-text').textContent;
  const label = el.querySelector('.np-example-label').textContent;
  document.getElementById('npDescription').value = text;
  document.getElementById('npTitle').value = '';
  document.getElementById('npCharCount').textContent = text.length;
  // Auto-set complexity/data based on label
  if (label.toLowerCase().includes('joint') || label.toLowerCase().includes('data')) {
    document.getElementById('npComplexity').value = 'HIGH';
    document.getElementById('npDataRequired').value = 'true';
  } else if (label.toLowerCase().includes('simple')) {
    document.getElementById('npComplexity').value = 'MEDIUM';
    document.getElementById('npDataRequired').value = 'false';
  }
  showToast('Example loaded â€” edit it to fit your needs');
}

function clearProjectForm() {
  document.getElementById('npTitle').value = '';
  document.getElementById('npDescription').value = '';
  document.getElementById('npComplexity').value = 'MEDIUM';
  document.getElementById('npDataRequired').value = 'false';
  document.getElementById('npRunClassify').checked = false;
  document.getElementById('npCharCount').textContent = '0';
  document.getElementById('npResult').style.display = 'none';
}

async function createProject() {
  const description = document.getElementById('npDescription').value.trim();
  if (!description) {
    showToast('Please enter a project description');
    document.getElementById('npDescription').focus();
    return;
  }

  const title = document.getElementById('npTitle').value.trim();
  const complexity = document.getElementById('npComplexity').value;
  const dataRequired = document.getElementById('npDataRequired').value === 'true';
  const runClassify = document.getElementById('npRunClassify').checked;

  const btn = document.getElementById('npSubmit');
  btn.classList.add('loading');
  btn.innerHTML = '<span class="btn-icon">â³</span> Creatingâ€¦';

  try {
    const res = await fetch('/api/projects', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ description, title, complexity, data_required: dataRequired, run_classify: runClassify })
    });
    const data = await res.json();

    const resultEl = document.getElementById('npResult');
    resultEl.style.display = 'block';

    if (res.ok) {
      resultEl.className = 'np-result success';
      resultEl.innerHTML = `
        <div class="np-result-header">
          <span class="icon">âœ…</span>
          <span class="title">Project Created</span>
        </div>
        <div class="np-result-id">${data.project_id}</div>
        <div style="font-size:12px;color:var(--text-secondary);margin-bottom:8px;">${data.message}</div>
        <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-dim);margin-bottom:12px;">File: ${data.path}</div>
        <div style="font-size:11px;font-weight:600;color:var(--text-secondary);margin-bottom:6px;">Next steps:</div>
        <div class="np-result-next">
          <div class="np-result-cmd">
            <span class="num">1</span>
            <span style="flex:1;">python agents/orchestrator/classify.py</span>
            <button class="copy-btn" onclick="event.stopPropagation(); copyCmd('python agents/orchestrator/classify.py', this)">copy</button>
          </div>
          <div class="np-result-cmd">
            <span class="num">2</span>
            <span style="flex:1;">python agents/orchestrator/router.py</span>
            <button class="copy-btn" onclick="event.stopPropagation(); copyCmd('python agents/orchestrator/router.py', this)">copy</button>
          </div>
          <div class="np-result-cmd">
            <span class="num">3</span>
            <span style="flex:1;">python agents/dev/strategy/product_manager.py</span>
            <button class="copy-btn" onclick="event.stopPropagation(); copyCmd('python agents/dev/strategy/product_manager.py', this)">copy</button>
          </div>
        </div>
        <div style="margin-top:12px;display:flex;gap:8px;">
          <button class="btn btn-secondary" onclick="selectNewProject('${data.project_id}')" style="font-size:11px;padding:8px 14px;">
            Open in Pipeline Tracker â†’
          </button>
          <button class="btn btn-secondary" onclick="clearProjectForm()" style="font-size:11px;padding:8px 14px;">
            Create Another
          </button>
        </div>
      `;

      // Refresh project list
      await loadProjects();
      showToast(`Project ${data.project_id} created!`);
    } else {
      resultEl.className = 'np-result error';
      resultEl.innerHTML = `
        <div class="np-result-header">
          <span class="icon">âŒ</span>
          <span class="title">Creation Failed</span>
        </div>
        <div style="font-size:12px;color:var(--status-error);">${data.error || 'Unknown error'}</div>
      `;
    }
  } catch (e) {
    const resultEl = document.getElementById('npResult');
    resultEl.style.display = 'block';
    resultEl.className = 'np-result error';
    resultEl.innerHTML = `
      <div class="np-result-header">
        <span class="icon">âš ï¸</span>
        <span class="title">Connection Error</span>
      </div>
      <div style="font-size:12px;color:var(--text-secondary);">Could not reach the server. Make sure <code>python app.py</code> is running.</div>
    `;
  }

  btn.classList.remove('loading');
  btn.innerHTML = '<span class="btn-icon">â–¸</span> Create Project';
}

function selectNewProject(projectId) {
  // Select the project and switch to pipeline view
  const sel = document.getElementById('projectSelect');
  sel.value = projectId;
  loadProject(projectId);
  // Switch to pipeline panel
  document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
  document.querySelector('[data-panel="pipeline"]').classList.add('active');
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('panel-pipeline').classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UPDATE & NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function updateAll() {
  updateTopBar();
  renderPipeline();
  renderAgents();
  renderProject();
  renderCheckpoints();
  renderCommands();
}

// Sidebar navigation
document.querySelectorAll('.sidebar-item').forEach(item => {
  item.addEventListener('click', () => {
    document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    const panel = item.dataset.panel;
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(`panel-${panel}`).classList.add('active');
    state.activePanel = panel;
  });
});

// Project select
document.getElementById('projectSelect').addEventListener('change', (e) => {
  loadProject(e.target.value);
});

// â”€â”€ Initialize â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

async function init() {
  await Promise.all([loadPipeline(), loadAgents(), loadProjects()]);
  updateAll();
  // Auto-refresh projects every 30s
  setInterval(loadProjects, 30000);
}

init();
</script>
</body>
</html>
